import{i as e,l as t}from"./iframe-BkS0wicH.js";import{t as n}from"./react-dom-BaEMFQiq.js";import{a as r,c as i,f as a,m as o,r as s,s as c,t as l,u}from"./useLatestRef-BNC1cvif.js";var d=t(e());function f({controlled:e,default:t,name:n,state:r=`value`}){let{current:i}=d.useRef(e!==void 0),[a,o]=d.useState(t),s=i?e:a,c=d.useCallback(e=>{i||o(e)},[]);return[s,c]}let p=function(e){return e.disabled=`data-disabled`,e.valid=`data-valid`,e.invalid=`data-invalid`,e.touched=`data-touched`,e.dirty=`data-dirty`,e.filled=`data-filled`,e.focused=`data-focused`,e}({});const m={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:null,valueMissing:!1},h={valid(e){return e===null?null:e?{[p.valid]:``}:{[p.invalid]:``}}};function g(e){return r(e,`base-ui`)}const _=d.createContext({invalid:void 0,controlId:void 0,setControlId:i,labelId:void 0,setLabelId:i,messageIds:[],setMessageIds:i,name:void 0,validityData:{state:m,errors:[],error:``,value:``,initialValue:null},setValidityData:i,disabled:void 0,touched:!1,setTouched:i,dirty:!1,setDirty:i,filled:!1,setFilled:i,focused:!1,setFocused:i,validate:()=>null,validationMode:`onBlur`,validationDebounceTime:0,state:{disabled:!1,valid:null,touched:!1,dirty:!1,filled:!1,focused:!1},markedDirtyRef:{current:!1}});function v(e=!0){let t=d.useContext(_);if(t.setControlId===i&&!e)throw Error(`Base UI: FieldRootContext is missing. Field parts must be placed within <Field.Root>.`);return t}const y=d.createContext({formRef:{current:{fields:new Map}},errors:{},clearErrors:i});function b(){return d.useContext(y)}function x(e,t){return{...e,state:{...e.state,valid:!t&&e.state.valid}}}var S=Object.keys(m);function C(e){if(!e||e.valid||!e.valueMissing)return!1;let t=!1;for(let n of S){if(n===`valid`)continue;n===`valueMissing`&&(t=e[n]),e[n]&&(t=!1)}return t}function w(){let{setValidityData:e,validate:t,messageIds:n,validityData:r,validationMode:i,validationDebounceTime:a,invalid:c,markedDirtyRef:l,controlId:f,state:p,name:h}=v(),{formRef:g,clearErrors:_}=b(),y=s(),w=d.useRef(null),T=o(async(n,i=!1)=>{let a=w.current;if(!a)return;if(i){if(p.valid!==!1)return;let t=a.validity;if(!t.valueMissing){let t={value:n,state:{...m,valid:!0},error:``,errors:[],initialValue:r.initialValue};if(a.setCustomValidity(``),f){let e=g.current.fields.get(f);e&&g.current.fields.set(f,{...e,...x(t,!1)})}e(t);return}let i=S.reduce((e,n)=>(e[n]=t[n],e),{});if(!i.valid&&!C(i))return}function o(e){let t=S.reduce((t,n)=>(t[n]=e.validity[n],t),{}),n=!1;for(let e of S){if(e===`valid`)continue;if(e===`valueMissing`&&t[e])n=!0;else if(t[e])return t}return n&&!l.current&&(t.valid=!0,t.valueMissing=!1),t}y.clear();let s=null,u=[],d=o(a),h;if(a.validationMessage)h=a.validationMessage,u=[a.validationMessage];else{let e=Array.from(g.current.fields.values()).reduce((e,t)=>(t.name&&t.getValueRef&&(e[t.name]=t.getValueRef.current?.()),e),{}),r=t(n,e);s=typeof r==`object`&&r&&`then`in r?await r:r,s!==null&&(d.valid=!1,d.customError=!0,Array.isArray(s)?(u=s,a.setCustomValidity(s.join(`
`))):s&&(u=[s],a.setCustomValidity(s)))}let _={value:n,state:d,error:h??(Array.isArray(s)?s[0]:s??``),errors:u,initialValue:r.initialValue};if(f){let e=g.current.fields.get(f);e&&g.current.fields.set(f,{...e,...x(_,c)})}e(_)}),E=d.useCallback((e={})=>u({...n.length&&{"aria-describedby":n.join(` `)},...p.valid===!1&&{"aria-invalid":!0}},e),[n,p.valid]),D=d.useCallback((e={})=>u({onChange(e){if(e.nativeEvent.defaultPrevented)return;if(_(h),i!==`onChange`){T(e.currentTarget.value,!0);return}if(c)return;let t=e.currentTarget;if(t.value===``){T(t.value);return}y.clear(),a?y.start(a,()=>{T(t.value)}):T(t.value)}},E(e)),[E,_,h,y,T,c,i,a]);return d.useMemo(()=>({getValidationProps:E,getInputValidationProps:D,inputRef:w,commitValidation:T}),[E,D,T])}var T=t(n());function E(e){let{formRef:t}=b(),{invalid:n,markedDirtyRef:r,validityData:i,setValidityData:o}=v(),{enabled:s=!0,value:c,id:u,name:d,controlRef:f,commitValidation:p}=e,m=l(e.getValue);a(()=>{if(!s)return;let e=c;e===void 0&&(e=m.current?.()),i.initialValue===null&&e!==i.initialValue&&o(t=>({...t,initialValue:e}))},[s,o,c,i.initialValue,m]),a(()=>{s&&u&&t.current.fields.set(u,{controlRef:f,validityData:x(i,n),validate(){let e=c;e===void 0&&(e=m.current?.()),r.current=!0,T.flushSync(()=>p(e))},getValueRef:m,name:d})},[p,f,s,t,m,u,n,r,d,i,c]),a(()=>{let e=t.current.fields;return()=>{u&&e.delete(u)}},[t,u])}function D(e,t,n){let r=!1,i=!1,a=n??c;return{reason:e,event:t??new Event(`base-ui`),cancel(){r=!0},allowPropagation(){i=!0},get isCanceled(){return r},get isPropagationAllowed(){return i},...a}}export{v as a,f as c,b as i,E as n,g as o,w as r,h as s,D as t};